package mid_test

import (
	"testing"

	"github.com/davecgh/go-spew/spew"
	"github.com/stretchr/testify/suite"

	"github.com/rlz-buro/mid"
)

type MIDTestSuite struct {
	suite.Suite
}

func TestMIDTestSuite(t *testing.T) {
	suite.Run(t, new(MIDTestSuite))
}

func (suite *MIDTestSuite) TestUnmarshal() {
	data := []byte("00200001001000000000")
	m := mid.MID{}
	err := mid.UnmarshalMID(data, &m)
	suite.NoError(err)
	suite.Equal(len(data), m.Header.Length)
	suite.Equal(1, m.Header.MID)
	suite.Equal(1, m.Header.Revision)
}

func (suite *MIDTestSuite) TestMarshal() {
	data := []byte("00200001001000000000")
	m := mid.MID{
		Header: mid.Header{
			Length:   20,
			MID:      1,
			Revision: 1,
		},
	}
	raw, err := mid.MarshalMID(m)
	suite.NoError(err)
	suite.Len(raw, len(data))
	suite.Equal(data, raw)
}

func (suite *MIDTestSuite) TestUnmarshal101() {
	data := []byte("02100101   0        01020286132552$L604117         030004004050000060000070080026000900340010      11     12     1300003142020-02-02:16:43:38152020-06-09:09:56:30160805217118050111003088100034060211003007100045")
	mid101 := mid.MID0101REV001{}
	err := mid.Unmarshal(data, &mid101)
	suite.NoError(err)
	spew.Dump(mid101)
}

func (suite *MIDTestSuite) TestUnmarshal106() {
	data := []byte("14090106            01190201031073817763040105CylinderHead-S      062023-06-16:19:28:15070308DEP ISB 4.5         0911001186132968                                1218130114115116117181.44518180.26419250.00020110.00021185.00022175.000130214115116117173.49718180.26419250.00020110.00021185.00022175.000130314115116117161.96818180.26419250.00020110.00021185.00022175.000130414115116117161.25318179.86719250.00020110.00021185.00022175.000130514115116117162.34618180.26419250.00020110.00021185.00022175.000130614115116117175.33318180.26419250.00020110.00021185.00022175.000130714115116117149.15518180.26419250.00020110.00021185.00022175.000130814115116117163.51818180.26419250.00020110.00021185.00022175.000130914115116117173.16418180.26419250.00020110.00021185.00022175.000131014115116117168.48618180.26419250.00020110.00021185.00022175.000131114115116117163.64918180.26419250.00020110.00021185.00022175.000131214115116117169.83718180.26419250.00020110.00021185.00022175.000131514115116117161.98318180.26419250.00020110.00021185.00022175.000131614115116117196.68418180.26419250.00020110.00021185.00022175.000131914115116117164.45318180.26419250.00020110.00021185.00022175.000132014115116117165.12818180.26419250.00020110.00021185.00022175.000132314115116117172.18618180.26419250.00020110.00021185.00022175.000132414115116117164.35618180.26419250.00020110.00021185.00022175.0002301Data No Station     I 100000010006")
	mid106 := mid.MID0106REV001{}
	err := mid.Unmarshal(data, &mid106)
	suite.NoError(err)
	spew.Dump(mid106)
}
